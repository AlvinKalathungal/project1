
---
title: 'Project 1: Wrangling, Exploration, Visualization'
author: "SDS322E"
date: ''
output:
  html_document:
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document:
    toc: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, fig.align = "center", warning = F, message = F,
tidy=TRUE, tidy.opts=list(width.cutoff=60), R.options=list(max.print=100))
```

## Data Wrangling, Exploration, Visualization

## Alvin Kalathungal | aak2874

### Introduction 
```{r}
library(tidyverse)
library(dplyr)
library(knitr)
library(ggplot2)
#install.packages("maptools")
library(maptools)
#install.packages("mapdata")
library(mapdata)
#install.packages("ggthemes")
#install.packages("usmap")
library("usmap")
library(ggthemes)
#install.packages("tibble")
library(tibble)
#install.packages("viridis")
library(viridis)
#install.packages("readr")
library(readr)
```

Paragraph or two introducing your datasets and variables, why they are interesting to you, etc.

```{R}

USVaccineData <- read_csv("USVaccineData")
#head(USVaccineData)
USCovidData <- read_csv("USCounties.csv")
#head(USCounties)

```

### Tidying: Reshaping

If your datasets are tidy already, demonstrate that you can reshape data with pivot wider/longer here (e.g., untidy and then retidy). Alternatively, it may be easier to wait until the wrangling section so you can reshape your summary statistics. Note here if you are going to do this.

```{R}
# your tidying code (if applicable; can also wait until wrangling section) Waiting til Wrangling section to Tidy/Reshape
```

    
### Joining/Merging

```{R}
#nrow(USCovidData) #3249
#nrow(USVaccineData) #3282
#distinct(USCovidData)
#distinct(USVaccineData)
left_join(USCovidData,USVaccineData, by="fips") %>% distinct(fips,.keep_all = TRUE) -> projectData
#anti_join(USVaccineData,USCovidData, by="fips") #10 that is in Vaccine but not Covid Data are metros or bourgoghs
#anti_join(USCovidData,USVaccineData, by="fips")  # 2 in Northern Mariana Islands
```

Discussions of joining here. Feel encouraged to break up into more than once code chunk and discuss each in turn.

###  Wrangling

```{r}
projectData %>% select(-c(11:14)) %>% relocate(Recip_State, .after=state) -> projectData
```

```{r}
projectData %>% summarise_at(c("cases","deaths"),.funs =list(mean=mean,min=min, max=max),na.rm=TRUE) %>% kable()
```





```{r}
projectData %>% group_by(state) %>% summarise_at(c("cases","deaths"),.funs =list(mean=mean,median=median,sd=sd,min=min, max=max),na.rm=TRUE) %>% pivot_longer(-1) %>% separate(name, into = c("var","stat")) %>% pivot_wider(names_from ="var", values_from = "value") %>% slice(1:20) %>% kable()
```

```{r}
projectData %>% summarize_all(function(x) sum(is.na(x)))

```


```{r}
projectData %>% group_by(state) %>% count(state,cases,deaths) %>% summarise(totalcases = sum(cases), totaldeaths = sum(deaths)) %>% mutate(percentSurvival = 1 - totaldeaths/totalcases) %>% arrange(desc(totalcases)) %>% slice(1:10) -> scatterplotData

#head(scatterplotData)

```

```{r}
projectData %>% group_by(Metro_status,state) %>% summarise_at("Series_Complete_Yes",.funs = list(mean=mean,sd=sd)) %>% arrange(state) %>% filter(state == "California" | state == "Texas"| state == "New York" | state == "Pennsylvania"| state == "Illinois"| state == "Ohio"| state == "Georgia" | state == "North Carolina" | state == "Michigan" | state == "Florida") -> barplotData

#head(barplotData)
```

```{r}
projectData %>% group_by(state) %>% count(state,cases) %>% summarise(totalcases = sum(cases))  -> CovidtotalStateCases

#head(CovidtotalStateCases)
```

Your discussion of wrangling section here. Feel encouraged to break up into more than once code chunk and discuss each in turn.


### Visualizing

```{r}
head(scatterplotData)
projectData %>% select(state,Recip_State) %>% group_by(state,Recip_State) -> stateInital
inner_join(scatterplotData,stateInital, by="state") -> scatterplotData


ggplot(scatterplotData,aes(x=totalcases, y=totaldeaths,color=state)) + geom_point() + scale_x_continuous(labels = scales::comma) + geom_text(aes(label=Recip_State),hjust=0.5, vjust=1.5) + theme(legend.position = "none") + ggtitle("Comparsion of Total Deaths with Total Number of Cases") + xlab("Total Number of Cases") + ylab("Total Number of Deaths")
```

Your discussion of plot 1

```{r}
projectData %>% select(state,county,Metro_status) %>% count(state,Metro_status, sort = TRUE) -> countiesInStates
head(countiesInStates)
head(barplotData)

inner_join(barplotData,countiesInStates, by= c("state","Metro_status")) %>% mutate(se = sd/sqrt(n)) -> barplotData
#head(barplotData)

```

```{R}
barplotData %>% ggplot(aes(x=state,y=mean, fill=Metro_status), ) + geom_bar(stat = "summary",position = "dodge") + geom_errorbar(aes(ymin = mean - se, ymax = mean + se),width=.5,position = position_dodge(0.8)) + theme_light() +scale_y_continuous(breaks = seq(0,600000,100000),labels = scales::comma) + theme(axis.text.x=element_text(angle=60, hjust=1,vjust = 1)) + ggtitle("Mean number of Fully Vaccinated in all counties in the Top 10 pop States") + xlab("Top Ten populated States") + ylab("Mean Number of Vaccination") + guides(fill=guide_legend(title='Metro Status'))
```

Your discussion of plot 2

```{R}
plot_usmap(data = CovidtotalStateCases, values = "totalcases", color="red" ) +  scale_fill_continuous(low = "white", high = "orangered",name = "Total Cases by State", label = scales::comma) + theme(legend.position = "right") + ggtitle("Total COVID-19 cases in US") + theme_dark() +  theme(axis.title.x=element_blank(),axis.text.x=element_blank(), axis.ticks.x=element_blank()) + theme(axis.title.y=element_blank(),axis.text.y=element_blank(), axis.ticks.y=element_blank())
```

Your discussion of plot 3

```{r}
plot_usmap(regions = "counties", data = projectData, values = "Series_Complete_Yes", include = c("TX")) +  theme_minimal() + scale_fill_continuous(low = "white", high= "red",name = "Fully Vaccinated by County", label = scales::comma) + theme(legend.position = "left") + ggtitle("Fully Vaccinated by County in Texas")+ theme(axis.title.x=element_blank(),axis.text.x=element_blank(), axis.ticks.x=element_blank()) + theme(axis.title.y=element_blank(),axis.text.y=element_blank(), axis.ticks.y=element_blank())
```


#### Concluding Remarks

If any!




